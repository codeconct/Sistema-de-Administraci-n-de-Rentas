import React, { useState, useEffect } from "react";
import "./ContractsList.css";
import ContratoForm from "../Forms/Contratoform";
import { REACT_APP_API_URL } from '../../config'

const token = localStorage.getItem("token");

const Viviendas = () => {
  const [contratos, setContratos] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  const [filtroStatus, setFiltroStatus] = useState("todos");
  const [filtroBusqueda, setFiltroBusqueda] = useState("");
  const [propiedadSeleccionada, setPropiedadSeleccionada] = useState(null);

  useEffect(() => {
    setPaginaActual(1); // Reset to first page on filter change
  }, [filtroStatus, filtroBusqueda]);

  {/* in this part you can change the number of items that appears in one page */ }
  const [paginaActual, setPaginaActual] = useState(1);
  const itemsPorPagina = 5; //only you need to change this number for change the items per page

  // ⬇ Fetch data from backend on page load
  useEffect(() => {
    const fetchData = async () => {
      try {
        const res = await fetch(`${REACT_APP_API_URL}/rentalcontracts`, {
          headers: { Authorization: `Bearer ${token}` }
        });

        if (!res.ok) throw new Error("Error loading data");

        const data = await res.json();
        setContratos(data);
        console.log(data);

      } catch (err) {
        console.error(err);
        setError("Error loading viviendas");
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, []);



  const formatDate = (date) => {
    if (!date) return ""; // ← If null, return nothing
    return new Date(date).toLocaleDateString("es-MX");
  };
  if (loading) return <div className="text-center py-5">Cargando datos...</div>;
  if (error) return <div className="text-center py-5 text-danger">{error}</div>;

  // ------------------------------
  //  NORMAL RENDER
  // ------------------------------

  return (
    <div className="bg-light min-vh-100">
      <div className="container-fluid px-5">

        <div className="d-flex justify-content-between align-items-center page-header">
          <div>
            <h2 className="fw-bold">Contratos</h2>
            <p className="text-muted mb-0">Consulta los contratos que han sido generados en el sistema.</p>
          </div>
          <button className="btn btn-dark">
            <i className="bi bi-plus"></i> Nuevo contrato
          </button>
        </div>

        <div className="mb-4">
          <div className="search-pill d-flex align-items-center">
            <i className="bi bi-search search-icon"></i>
            <input
              type="text"
              className="search-input"
              placeholder="Buscar..."
            //value={filtroBusqueda}
            //onChange={(e) => setFiltroBusqueda(e.target.value)}
            />
          </div>
        </div>
        <div className="table-responsive">
          <table className="table align-middle mb-0 table-light">
            <thead className="text-muted small">
              <tr>
                <th>ID</th>
                <th>Propiedad</th>
                <th>Arrendatario</th>
                <th>Fechas</th>
                <th>Alquiler</th>
                <th className="text-center">Acciones</th>
              </tr>
            </thead>
            <tbody>

              {contratos.map((prop) => (
                <tr>
                  <td>Contrato-{prop.id}</td>
                  <td>
                    <div className="fw-semibold">Departamento Corredor Privada Puerta Norte int. 109</div>
                    <div className="property-text">34155 Jardines, Dgo.</div>
                  </td>
                  <td>
                    <div className="d-flex align-items-center gap-2">
                      <img src="https://randomuser.me/api/portraits/men/32.jpg" className="avatar" />
                      <span>José Amaya</span>
                    </div>
                  </td>
                  <td>
                    <p>
                      {formatDate(prop.startdate)} <br />
                      al <br />
                      {formatDate(prop.enddate)}
                    </p>
                  </td>
                  <td className="price-text">$6,900 MXN</td>
                  <td className="text-center">
                    <button className="btn btn-outline-secondary btn-sm action-btn">
                      <i className="bi bi-pencil"></i> Editar
                    </button><br />
                    <button className="btn btn-outline-secondary btn-sm action-btn">
                      <i className="bi bi-eye"></i> Ver detalles
                    </button>
                  </td>
                </tr>))}


            </tbody>
          </table>
        </div>

        <div className="d-flex justify-content-between align-items-center footer-pagination">
          <span className="text-muted small">Mostrando {contratos.length} incidencias</span>

          <nav>
            <ul className="pagination pagination-sm mb-0">
              <li className="page-item disabled">
                <a className="page-link" href="#">‹</a>
              </li>
              <li className="page-item active">
                <a className="page-link" href="#">1</a>
              </li>
              <li className="page-item">
                <a className="page-link" href="#">›</a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  );
};

export default Viviendas;
